<?xml version="1.0"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" horizontalGap="10" xmlns:ns1="com.adobe.sync.components.*"
                creationComplete="onCreationComplete()" backgroundColor="0xFFFFFF" >

    <mx:Script><![CDATA[
        import mx.controls.Alert;
        import Date;

        import com.adobe.sync.events.SyncSwfEvent;

        private var myAlertState:Boolean = false;
        private var count:Number = 0;
        private var intervalID:uint;

        private function changeAlertState():Boolean {
            trace(myAlertState);
            myAlertState = !myAlertState;
            syncConnector.dispatchSyncMessage("alert", myAlertState, false, true);
            return myAlertState;

        }

        //Flashes the SBU Signal and stops after 50 loops
        private function flashSignal():void {
            changeAlertState();
            signal1Image.setVisible(!myAlertState);
            signal2Image.setVisible(myAlertState);

            syncConnector.dispatchSyncMessage("img1Vis", signal1Image.visible, false, true);
            syncConnector.dispatchSyncMessage("img2Vis", signal2Image.visible, false, true);
            count++;

            if (count == 40) {

                clearInterval(intervalID);

                count = 0;
            }
        }

        private function onCreationComplete():void {

        }


        private function caughtUp(p_evt:SyncSwfEvent):void {

        }

        private function syncMessageReceived(p_evt:SyncSwfEvent):void {
            if(p_evt.data.msgNm == "img1Vis")
                signal1Image.setVisible(p_evt.data.msgVal);

            if(p_evt.data.msgNm == "img2Vis")
                signal2Image.setVisible(p_evt.data.msgVal);

//            if(p_evt.data.msgNm == "date")
//                properties_ta.text = p_evt.data.msgVal;

        }
        ]]></mx:Script>

    <mx:Button label="Send the SBU Signal" id="SBU_btn" click="if(count == 0) {intervalID = setInterval(flashSignal, 85);
                                                                               syncConnector.dispatchSyncMessage('date', Date.UTC, false, true);}

                                                                               else if(count > 0){clearInterval(intervalID);
                                                                               count = 0;
                                                                               signal1Image.setVisible(true); signal2Image.setVisible(false);
                                                                               };"></mx:Button>
    <!--<mx:TextArea width="5%" height="5%" id="properties_ta" x ="0" y ="40"/>-->
    <mx:Image id="signal1Image" source="@Embed(source='../img/signal1.svg')" x="150" y="0" visible="true"/>
    <mx:Image id="signal2Image" source="@Embed(source='../img/signal2.svg')" x="150" y="0" visible="false"/>


    <ns1:SyncConnector id = "syncConnector" syncMessageReceived = "syncMessageReceived(event)" caughtUp="caughtUp(event)"/>
    <!--<ns1:ConnectionEmulator id = "connectionEmulator" bSyncConnector="{syncConnector}"/>-->
</mx:Application>
